# PostgreSQL Client Authentication Configuration
# Windows Production Configuration for Odoo 17
# Optimized for 50 concurrent users

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# ====================================
# LOCAL CONNECTIONS (Windows)
# ====================================
# Local connections via Windows named pipes
local   all             postgres                                peer
local   all             admin                                   md5
local   all             all                                     md5

# ====================================
# IPv4 LOCAL CONNECTIONS
# ====================================
# localhost connections
host    all             postgres        127.0.0.1/32           reject
host    all             admin           127.0.0.1/32           md5
host    all             all             127.0.0.1/32           md5

# ====================================
# IPv6 LOCAL CONNECTIONS
# ====================================
host    all             postgres        ::1/128                 reject
host    all             admin           ::1/128                 md5
host    all             all             ::1/128                 md5

# ====================================
# NETWORK CONNECTIONS (Production)
# ====================================
# Allow Odoo application server connections
# Adjust IP ranges according to your network setup

# Same server connections (typical for single-server deployment)
host    all             admin           192.168.0.21/32        md5

# Private network range (adjust as needed)
host    all             admin           192.168.0.0/24         md5
host    all             admin           10.0.0.0/8             md5
host    all             admin           172.16.0.0/12          md5

# ====================================
# SECURITY RESTRICTIONS
# ====================================
# Explicitly reject postgres superuser from network
host    all             postgres        0.0.0.0/0              reject
host    all             postgres        ::/0                   reject

# ====================================
# REPLICATION CONNECTIONS (Future)
# ====================================
# Uncomment and configure if setting up replication
# host    replication     admin           192.168.0.0/24         md5

# ====================================
# SECURITY NOTES
# ====================================
# 1. The 'postgres' superuser is restricted to local connections only
# 2. 'admin' user is used for Odoo application connections
# 3. All network connections require MD5 password authentication
# 4. Adjust IP ranges according to your network topology
# 5. Consider using 'scram-sha-256' instead of 'md5' for better security
# 6. Monitor failed authentication attempts in PostgreSQL logs
# 7. Regularly rotate database passwords
# 8. Consider certificate-based authentication for high-security environments

# ====================================
# AUTHENTICATION METHODS EXPLAINED
# ====================================
# peer     - Use OS username (Windows integrated authentication)
# md5      - MD5 password authentication
# scram-sha-256 - More secure password authentication (PostgreSQL 10+)
# trust    - No authentication (NOT recommended for production)
# reject   - Reject connection
# cert     - Certificate-based authentication

# ====================================
# IP ADDRESS FORMATS
# ====================================
# IPv4: 192.168.1.100/32 (single host)
# IPv4: 192.168.1.0/24   (subnet)
# IPv6: ::1/128          (single host)
# IPv6: 2001:db8::/32    (subnet)

# ====================================
# PRODUCTION RECOMMENDATIONS
# ====================================
# 1. Use specific IP addresses instead of broad ranges when possible
# 2. Regularly review and update connection rules
# 3. Enable connection logging for security monitoring
# 4. Use firewall rules as additional security layer
# 5. Consider VPN for remote administrative access
# 6. Implement fail2ban or similar tools for brute force protection